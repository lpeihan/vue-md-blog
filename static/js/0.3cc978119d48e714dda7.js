webpackJsonp([0],{"1wBV":function(s,a,t){s.exports=t("FsFo")},FsFo:function(s,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=t("rEVT"),v=t("18Nq"),_=Object(v.a)(null,n.a,n.b,!1,null,null,null);a.default=_.exports},rEVT:function(s,a,t){"use strict";t.d(a,"a",function(){return n}),t.d(a,"b",function(){return v});var n=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},v=[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("p",[s._v("{"),t("br"),s._v("  “title”: “闭包的理解”,"),t("br"),s._v("  “date”: “2017-12-22”,"),t("br"),s._v("  “tags”: “javascript”"),t("br"),s._v("}")]),s._v(" "),t("h2",{attrs:{id:"-"}},[s._v("闭包的定义和特性")]),s._v(" "),t("p",[t("code",[s._v("闭包")]),s._v("是指有权访问另一个函数作用域中的变量的函数，创建闭包的最常见的方式就是在一个函数内创建另一个函数，通过另一个函数访问这个函数的局部变量。")]),s._v(" "),t("p",[s._v("闭包有下面三个特性：")]),s._v(" "),t("ol",[t("li",[s._v("函数嵌套函数。")]),s._v(" "),t("li",[s._v("函数内部可以引用外部的参数和变量")]),s._v(" "),t("li",[s._v("参数和变量不会被垃圾回收机制回收"),s._v("\n下面看个例子：")])]),s._v(" "),t("pre",[t("code",{staticClass:"lang-javascript"},[s._v("function f1() {\n  let i = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(";\n"),t("p",[s._v("const f2 = function() {\n++i;\nconsole.log(i);\n}")]),s._v("\n"),t("p",[t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" f2;\n}")]),s._v("\n"),t("p",[s._v("let "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("fun")]),s._v(" = "),t("span",{staticClass:"hljs-title"},[s._v("f1")]),t("span",{staticClass:"hljs-params"},[s._v("()")])]),s._v(";")]),s._v("\n"),t("p",[t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-title"},[s._v("fun")]),t("span",{staticClass:"hljs-params"},[s._v("()")])]),s._v("; "),t("span",{staticClass:"hljs-comment"},[s._v("// 1")]),s._v("\n"),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-title"},[s._v("fun")]),t("span",{staticClass:"hljs-params"},[s._v("()")])]),s._v("; "),t("span",{staticClass:"hljs-comment"},[s._v("// 2")])]),s._v("\n"),t("p",[t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("fun")]),s._v(" = "),t("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v("; // a 被回收")]),s._v("\n")])])]),t("p"),s._v(" "),t("p",[s._v("在上面这段代码中，"),t("code",[s._v("fun")]),s._v("一共运行了两次，第一次"),t("code",[s._v("1")]),s._v("，第二次"),t("code",[s._v("2")]),s._v("。这证明了函数"),t("code",[s._v("f1")]),s._v("中的局部变量"),t("code",[s._v("i")]),s._v("一直保存在内存中，并没有在"),t("code",[s._v("fun")]),s._v("调用后被自动清除。")]),s._v(" "),t("p",[s._v("为什么会这样呢？原因就在于"),t("code",[s._v("f1")]),s._v("是"),t("code",[s._v("f2")]),s._v("的父函数，而"),t("code",[s._v("f2")]),s._v("被赋给了一个全局变量，这导致"),t("code",[s._v("f2")]),s._v("始终在内存中，而"),t("code",[s._v("f2")]),s._v("的存在依赖于"),t("code",[s._v("f1")]),s._v("，因此"),t("code",[s._v("f1")]),s._v("也始终在内存中，不会在调用结束后，被垃圾回收机制（"),t("code",[s._v("garbage collection")]),s._v("）回收。")]),s._v(" "),t("p",[s._v("由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题。在"),t("code",[s._v("IE")]),s._v("中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。")]),s._v(" "),t("p",[s._v("接下来看一个经典的例子：")]),s._v(" "),t("pre",[t("code",{staticClass:"lang-javascript"},[t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" i = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("; i < "),t("span",{staticClass:"hljs-number"},[s._v("5")]),s._v("; i++) {\n  setTimeout("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(i);  \n  }, "),t("span",{staticClass:"hljs-number"},[s._v("1000")]),s._v(" * i);\n}\n"),t("span",{staticClass:"hljs-comment"},[s._v("// 打印了5个5")]),s._v("\n"),t("p",[t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" i = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("; i < "),t("span",{staticClass:"hljs-number"},[s._v("5")]),s._v("; i++) {\nsetTimeout("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n"),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(i);"),t("br"),s._v("\n}, "),t("span",{staticClass:"hljs-number"},[s._v("1000")]),s._v(");\n}\n"),t("span",{staticClass:"hljs-comment"},[s._v("// 0 1 2 3 4 ")])]),s._v("\n"),t("p",[t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" i = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("; i < "),t("span",{staticClass:"hljs-number"},[s._v("5")]),s._v("; i++) {\n("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("i")]),s._v(") ")]),s._v("{\nsetTimeout("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n"),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(i);"),t("br"),s._v("\n}, "),t("span",{staticClass:"hljs-number"},[s._v("1000")]),s._v(" * i);\n})(i);\n}\n"),t("span",{staticClass:"hljs-comment"},[s._v("// 0 1 2 3 4")])]),s._v("\n"),t("p",[t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" i = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("; i < "),t("span",{staticClass:"hljs-number"},[s._v("5")]),s._v("; i++) {\nsetTimeout(("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("i")]),s._v(") ")]),s._v("{\n"),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n"),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(i);\n}\n})(i), i * "),t("span",{staticClass:"hljs-number"},[s._v("1000")]),s._v(");\n}\n")])])]),t("p"),s._v(" "),t("p",[s._v("下面有几句话帮助理解闭包：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("闭包是一个有状态（不消失的私有数据）的函数")])]),s._v(" "),t("li",[t("p",[s._v("打破作用域规则的变量就是闭包 ")])])])])}]}});
//# sourceMappingURL=0.3cc978119d48e714dda7.js.map